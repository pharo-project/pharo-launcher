Class {
	#name : #PhLHTTPListingTemplateGroupTest,
	#superclass : #PhLAbstractTemplateGroupTest,
	#category : #'PharoLauncher-Tests-Debug'
}

{ #category : #coverage }
PhLHTTPListingTemplateGroupTest >> classToBeTested [
	^ PhLHTTPListingTemplateGroup
]

{ #category : #helpers }
PhLHTTPListingTemplateGroupTest >> exampleContent [
	^ '<html>
	<head></head><body>
	<a href="foo.html">foo.zip</a>
	<a href="bla1.zip">bla1.zip</a>
	... bla bla ...
	<a href="bla2.zip">bla2.zip</a>
	... bla bla ...
	</body>
	</html>'
]

{ #category : #helpers }
PhLHTTPListingTemplateGroupTest >> exampleUrl [
	^ 'http://foo.example.com/bar' asZnUrl
]

{ #category : #'instance creation' }
PhLHTTPListingTemplateGroupTest >> newGroup [
	^ PhLHTTPListingTemplateGroup name: 'Test' url: self exampleUrl
]

{ #category : #'instance creation' }
PhLHTTPListingTemplateGroupTest >> newPharo12Group [

	^ PhLHTTPListingTemplateGroup 
		name: 'TestPharo12' 
		url: self pharo12ExampleUrl 
		filterPattern: 'href="(Pharo-?12(.[0-9]+)?-SNAPSHOT.build.[^"]*.zip)"'
]

{ #category : #helpers }
PhLHTTPListingTemplateGroupTest >> pharo12ExampleContent [
	^ '<!DOCTYPE html><!--[if lt IE 9]><html class="no-js oldie" lang="en"><![endif]--><!--[if gt IE 8]><!--><html class="no-js" lang="en"><!--<![endif]--><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>index · styled with h5ai 0.22.1 (http://larsjung.de/h5ai/)</title><meta name="description" content="index styled with h5ai 0.22.1 (http://larsjung.de/h5ai/)"><meta name="viewport" content="width=device-width"><link rel="shortcut icon" href="/_h5ai/client/images/app-16x16.ico"><link rel="apple-touch-icon" type="image/png" href="/_h5ai/client/images/app-48x48.png"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ubuntu+Mono:400,700,400italic,700italic|Ubuntu:400,700,400italic,700italic"><link rel="stylesheet" href="/_h5ai/client/css/styles.css"><script src="/_h5ai/client/js/scripts.js" data-mode="aai"></script></head><body id="h5ai-main"><div id="topbar" class="clearfix"><ul id="navbar"></ul></div><div id="content"><div id="extended" class="clearfix"></div></div><div id="bottombar" class="clearfix"><span class="left"><a id="h5ai-reference" href="http://larsjung.de/h5ai/" title="h5ai · a modern HTTP web server index">h5ai 0.22.1</a><span class="hideOnJs noJsMsg">⚡ JavaScript is disabled! ⚡</span><span class="oldBrowser">⚡ Some features disabled! Works best in <a href="http://browsehappy.com">modern browsers</a>. ⚡</span></span><span class="right"></span><span class="center"></span></div><div id="data-apache-autoindex" class="hideOnJs"><!-- The following code was generated by Apache''s autoindex module.-->  
<table>
   <tr><th valign="top"><img src="/__ovh_icons/blank.gif" alt="[ICO]" /></th><th><a href="?C=N;O=A">Name</a></th><th><a href="?C=M;O=A">Last modified</a></th><th><a href="?C=S;O=A">Size</a></th></tr>
<tr><td valign="top"><img src="/__ovh_icons/back.gif" alt="[PARENTDIR]" /></td><td><a href="/image/">Parent Directory</a></td><td>&nbsp;</td><td align="right">  - </td></tr>
<tr><td valign="top"><img src="/__ovh_icons/compressed.gif" alt="[   ]" /></td><td><a href="stable-64.zip">stable-64.zip</a></td><td align="right">2024-01-30 10:44  </td><td align="right"> 23M</td></tr>
<tr><td valign="top"><img src="/__ovh_icons/compressed.gif" alt="[   ]" /></td><td><a href="latest-minimal-64.zip">latest-minimal-64.zip</a></td><td align="right">2024-01-30 10:44  </td><td align="right">3.0M</td></tr>
<tr><td valign="top"><img src="/__ovh_icons/compressed.gif" alt="[   ]" /></td><td><a href="latest-64.zip">latest-64.zip</a></td><td align="right">2024-01-30 10:44  </td><td align="right"> 23M</td></tr>
<tr><td valign="top"><img src="/__ovh_icons/compressed.gif" alt="[   ]" /></td><td><a href="Pharo1212.0-SNAPSHOT.build.1256.sha.7a6c05e.arch.64bit.zip">Pharo1212.0-SNAPSHOT.build.1256.sha.7a6c05e.arch.64bit.zip</a></td><td align="right">2023-12-28 22:22  </td><td align="right"> 15M</td></tr>
<tr><td valign="top"><img src="/__ovh_icons/compressed.gif" alt="[   ]" /></td><td><a href="Pharo1212.0-SNAPSHOT-metacello.build.1256.sha.7a6c05e.arch.64bit.zip">Pharo1212.0-SNAPSHOT-metacello.build.1256.sha.7a6c05e.arch.64bit.zip</a></td><td align="right">2023-12-28 22:22  </td><td align="right">3.0M</td></tr>
<tr><td valign="top"><img src="/__ovh_icons/compressed.gif" alt="[   ]" /></td><td><a href="Pharo12.0-SNAPSHOT.build.1329.sha.25a911c.arch.64bit.zip">Pharo12.0-SNAPSHOT.build.1329.sha.25a911c.arch.64bit.zip</a></td><td align="right">2024-01-30 10:44  </td><td align="right"> 23M</td></tr>
<tr><td valign="top"><img src="/__ovh_icons/compressed.gif" alt="[   ]" /></td><td><a href="Pharo12.0-SNAPSHOT.build.1328.sha.10f5de5.arch.64bit.zip">Pharo12.0-SNAPSHOT.build.1328.sha.10f5de5.arch.64bit.zip</a></td><td align="right">2024-01-29 21:41  </td><td align="right"> 23M</td></tr>
<tr><td valign="top"><img src="/__ovh_icons/compressed.gif" alt="[   ]" /></td><td><a href="Pharo12-SNAPSHOT.build.1229.sha.ed99075.arch.64bit.zip">Pharo12-SNAPSHOT.build.1229.sha.ed99075.arch.64bit.zip</a></td><td align="right">2023-12-17 22:22  </td><td align="right"> 21M</td></tr>
<tr><td valign="top"><img src="/__ovh_icons/compressed.gif" alt="[   ]" /></td><td><a href="Pharo12-SNAPSHOT.build.1228.sha.826d9bb.arch.64bit.zip">Pharo12-SNAPSHOT.build.1228.sha.826d9bb.arch.64bit.zip</a></td><td align="right">2023-12-16 18:34  </td><td align="right"> 21M</td></tr>
<tr><td valign="top"><img src="/__ovh_icons/compressed.gif" alt="[   ]" /></td><td><a href="Pharo12-SNAPSHOT-metacello.build.4.sha.cb2a5dd.arch.64bit.zip">Pharo12-SNAPSHOT-metacello.build.4.sha.cb2a5dd.arch.64bit.zip</a></td><td align="right">2023-03-15 20:28  </td><td align="right">4.0M</td></tr>
</table>
<!-- generated code ends here--></div></body></html>'
]

{ #category : #helpers }
PhLHTTPListingTemplateGroupTest >> pharo12ExampleUrl [
	^ 'https://files.pharo.org/image/120/' asZnUrl
]

{ #category : #running }
PhLHTTPListingTemplateGroupTest >> setUp [
	super setUp.
	self downloadManager atUrl: self exampleUrl answer: self exampleContent.
	self downloadManager atUrl: self pharo12ExampleUrl answer: self pharo12ExampleContent
]

{ #category : #tests }
PhLHTTPListingTemplateGroupTest >> testCanMatchPharo12Templates [
	| group templatesAndGroups |
	group := self newPharo12Group.
	
	templatesAndGroups := group templatesAndGroups.
	
	self assert: (templatesAndGroups noneSatisfy: [ :template | template isTemplateGroup ]).
	self 
		assertCollection: (templatesAndGroups collect: #name) 
		hasSameElements: #('Pharo12.0-SNAPSHOT.build.1329.sha.25a911c.arch.64bit'
								'Pharo12.0-SNAPSHOT.build.1328.sha.10f5de5.arch.64bit'
								'Pharo12-SNAPSHOT.build.1229.sha.ed99075.arch.64bit'
								'Pharo12-SNAPSHOT.build.1228.sha.826d9bb.arch.64bit')
]

{ #category : #tests }
PhLHTTPListingTemplateGroupTest >> testIsGroup [
	self assert: self newGroup isTemplateGroup
]

{ #category : #tests }
PhLHTTPListingTemplateGroupTest >> testTemplatesAndGroups [
	| group templatesAndGroups |
	group := self newGroup.
	templatesAndGroups := group templatesAndGroups.
	self assert: templatesAndGroups size equals: 2.	"<- 2 archive links in exampleContent"
	self assert: (templatesAndGroups noneSatisfy: [ :template | template isTemplateGroup ]).
	self assert: (templatesAndGroups collect: #name) asSet equals: #('bla1' 'bla2') asSet
]
